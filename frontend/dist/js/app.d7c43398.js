(()=>{"use strict";var e={7854:(e,r,t)=>{t(3792),t(3362),t(9085),t(9391);var a=t(3751),s=t(641),o={id:"app"},n={class:"container pb-5"};function l(e,r,t,a,l,i){var c=(0,s.g2)("SearchBar"),u=(0,s.g2)("SearchResults");return(0,s.uX)(),(0,s.CE)("div",o,[r[0]||(r[0]=(0,s.Lk)("nav",{class:"navbar navbar-expand-lg navbar-primary bg-primary"},[(0,s.Lk)("div",{class:"container"},[(0,s.Lk)("a",{class:"navbar-brand text-white",href:"#"},[(0,s.Lk)("i",{class:"bi bi-book"}),(0,s.eW)(" E-Book ")])])],-1)),(0,s.Lk)("div",n,[(0,s.bF)(c,{onSearch:i.handleSearch},null,8,["onSearch"]),(0,s.bF)(u,{books:l.searchResults,platforms:l.platforms,hasSearched:l.hasSearched},null,8,["books","platforms","hasSearched"])])])}var i=t(4048),c=t(9201),u=t(388),d=(t(2062),t(2010),t(1454),t(33)),h={class:"search-bar mb-4"},p={class:"card shadow-sm"},b={class:"card-body"},k={class:"form-group"},v={class:"input-group mb-3"},f=["disabled"],m={key:0,class:"alert alert-danger mt-2"};function g(e,r,t,o,n,l){return(0,s.uX)(),(0,s.CE)("div",h,[(0,s.Lk)("div",p,[(0,s.Lk)("div",b,[r[5]||(r[5]=(0,s.Lk)("h4",{class:"card-title mb-4 text-primary"},"🔍",-1)),(0,s.Lk)("div",k,[(0,s.Lk)("div",v,[(0,s.bo)((0,s.Lk)("input",{"onUpdate:modelValue":r[0]||(r[0]=function(e){return n.searchInput=e}),type:"text",class:"form-control form-control-lg",placeholder:"输入书名或ISBN码",onKeyup:r[1]||(r[1]=(0,a.jR)((function(){return l.handleSearch&&l.handleSearch.apply(l,arguments)}),["enter"]))},null,544),[[a.Jo,n.searchInput]]),(0,s.Lk)("button",{onClick:r[2]||(r[2]=function(){return l.handleSearch&&l.handleSearch.apply(l,arguments)}),class:"btn btn-primary btn-lg",disabled:!l.isValidInput},r[3]||(r[3]=[(0,s.Lk)("i",{class:"bi bi-search me-1"},null,-1),(0,s.eW)(" 搜索 ")]),8,f)]),n.error?((0,s.uX)(),(0,s.CE)("div",m,(0,d.v_)(n.error),1)):(0,s.Q3)("",!0),r[4]||(r[4]=(0,s.Lk)("small",{class:"form-text text-muted"}," 支持书名或ISBN码（10位或13位数字）搜索 ",-1))])])])])}t(7495),t(906),t(2762),t(6031);var L=t(4335);const y={name:"SearchBar",data:function(){return{searchInput:"",error:"",currentRequest:null,debounceTimeout:null,isSearching:!1}},computed:{isValidInput:function(){return this.searchInput.trim()&&!this.error}},watch:{searchInput:function(e){this.validateInput(e)}},methods:{validateInput:function(e){var r=e.trim();r&&/^\d+$/.test(r)&&10!==r.length&&13!==r.length?this.error="ISBN必须是10位或13位数字":this.error=""},handleSearch:function(){var e=this,r=this.searchInput.trim();r?(this.debounceTimeout&&(clearTimeout(this.debounceTimeout),console.log("已清除之前的防抖定时器")),this.currentRequest&&(this.currentRequest.cancel("新的搜索请求"),console.log("已取消之前的搜索请求"),this.currentRequest=null,this.isSearching=!1),this.isSearching?console.log("当前正在搜索，忽略新的搜索请求"):this.debounceTimeout=setTimeout((0,u.A)((0,i.A)().mark((function r(){var t,a,s;return(0,i.A)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(r.prev=0,t=e.searchInput.trim(),t){r.next=4;break}return r.abrupt("return");case 4:return a=L.A.CancelToken.source(),e.currentRequest=a,e.isSearching=!0,e.$emit("search-start"),console.log("开始搜索:",t),r.next=11,e.$emit("search",t,a.token);case 11:console.log("搜索成功:",t),r.next=24;break;case 14:if(r.prev=14,r.t0=r["catch"](0),!L.A.isCancel(r.t0)){r.next=19;break}return console.log("请求取消:",r.t0.message),r.abrupt("return");case 19:console.error("搜索错误:",r.t0),s="搜索请求失败，请重试",r.t0.response?s=r.t0.response.data.message||"服务器返回错误":r.t0.request&&(s="无法连接到服务器"),e.error="搜索失败: ".concat(s),e.$emit("search-error",r.t0);case 24:return r.prev=24,e.currentRequest=null,e.isSearching=!1,e.$emit("search-end"),console.log("搜索结束"),r.finish(24);case 30:case"end":return r.stop()}}),r,null,[[0,14,24,30]])}))),50)):this.error="请输入搜索内容"},beforeUnmount:function(){this.debounceTimeout&&clearTimeout(this.debounceTimeout),this.currentRequest&&this.currentRequest.cancel("组件卸载")}}};var S=t(6262);const _=(0,S.A)(y,[["render",g],["__scopeId","data-v-eaed111a"]]),C=_;var x={class:"search-results"},w={key:0,class:"platform-status-bar"},E={class:"platform-badges"},I={key:1,class:"results-table"},O={class:"table-header"},B={class:"col-book-info"},X=["title"],A={class:"col-book-info"},R={class:"book-info-main"},T={class:"book-title"},z={key:0,class:"book-author"},j={class:"book-details"},q={key:0},Q={key:1},W={key:2},F={key:3},P={key:4},$={class:"col-author"},K={class:"col-publisher"},M={class:"col-link"},N=["href"],U={class:"col-source"},Z={key:2,class:"no-results"},V={key:3,class:"example-books"},D={class:"results-table"},J={class:"table-header"},G={class:"col-book-info"},H=["title"],Y={class:"col-book-info"},ee={class:"book-title"},re={class:"book-details"},te={class:"col-author"},ae={class:"col-publisher"},se={class:"col-source"},oe={class:"source-badge"};function ne(e,r,t,a,o,n){return(0,s.uX)(),(0,s.CE)("div",x,[t.platforms.length>0?((0,s.uX)(),(0,s.CE)("div",w,[r[2]||(r[2]=(0,s.Lk)("div",{class:"platform-status-title"},"搜索来源:",-1)),(0,s.Lk)("div",E,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(t.platforms,(function(e){return(0,s.uX)(),(0,s.CE)("span",{key:e.id,class:(0,d.C4)(["platform-badge",{"platform-badge-available":e.available}])},(0,d.v_)(e.name)+": "+(0,d.v_)(e.available?"找到 ".concat(e.total," 个结果"):"无结果"),3)})),128))])])):(0,s.Q3)("",!0),t.books.length>0?((0,s.uX)(),(0,s.CE)("div",I,[(0,s.Lk)("div",O,[(0,s.Lk)("div",B,[r[4]||(r[4]=(0,s.eW)(" 书籍信息 ")),(0,s.Lk)("button",{class:"sort-button",onClick:r[0]||(r[0]=function(){return n.toggleSort&&n.toggleSort.apply(n,arguments)}),title:n.getSortTitle},[r[3]||(r[3]=(0,s.eW)(" 年份排序 ")),(0,s.Lk)("i",{class:(0,d.C4)(["bi",n.getSortIcon])},null,2)],8,X)]),r[5]||(r[5]=(0,s.Lk)("div",{class:"col-author"},"作者",-1)),r[6]||(r[6]=(0,s.Lk)("div",{class:"col-publisher"},"出版商",-1)),r[7]||(r[7]=(0,s.Lk)("div",{class:"col-link"},"直达链接",-1)),r[8]||(r[8]=(0,s.Lk)("div",{class:"col-source"},"来源平台",-1))]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.sortedBooks,(function(e){return(0,s.uX)(),(0,s.CE)("div",{class:"table-row",key:e.isbn},[(0,s.Lk)("div",A,[(0,s.Lk)("div",R,[(0,s.Lk)("div",T,(0,d.v_)(e.title),1),e.author?((0,s.uX)(),(0,s.CE)("div",z,(0,d.v_)(e.author),1)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",j,[e.year?((0,s.uX)(),(0,s.CE)("span",q,(0,d.v_)(e.year),1)):(0,s.Q3)("",!0),e.language?((0,s.uX)(),(0,s.CE)("span",Q,(0,d.v_)(e.language),1)):(0,s.Q3)("",!0),e.filesize?((0,s.uX)(),(0,s.CE)("span",W,(0,d.v_)(e.filesize),1)):(0,s.Q3)("",!0),e.extension?((0,s.uX)(),(0,s.CE)("span",F,(0,d.v_)(e.extension),1)):(0,s.Q3)("",!0),e.isbn?((0,s.uX)(),(0,s.CE)("span",P,"ISBN: "+(0,d.v_)(e.isbn),1)):(0,s.Q3)("",!0)])]),(0,s.Lk)("div",$,(0,d.v_)(e.author),1),(0,s.Lk)("div",K,(0,d.v_)(e.publisher),1),(0,s.Lk)("div",M,[(0,s.Lk)("a",{href:e.book_url,target:"_blank",class:"download-link"},r[9]||(r[9]=[(0,s.Lk)("i",{class:"fas fa-download"},null,-1),(0,s.eW)(" 下载 ")]),8,N)]),(0,s.Lk)("div",U,[(0,s.Lk)("span",{class:(0,d.C4)(["source-badge","source-".concat(e.platform_id)])},(0,d.v_)(e.source),3)])])})),128))])):t.hasSearched?((0,s.uX)(),(0,s.CE)("div",Z," 未找到相关书籍 ")):((0,s.uX)(),(0,s.CE)("div",V,[r[17]||(r[17]=(0,s.Lk)("div",{class:"example-title"},"示例书籍",-1)),(0,s.Lk)("div",D,[(0,s.Lk)("div",J,[(0,s.Lk)("div",G,[r[11]||(r[11]=(0,s.eW)(" 书籍信息 ")),(0,s.Lk)("button",{class:"sort-button",onClick:r[1]||(r[1]=function(){return n.toggleSort&&n.toggleSort.apply(n,arguments)}),title:n.getSortTitle},[r[10]||(r[10]=(0,s.eW)(" 年份排序 ")),(0,s.Lk)("i",{class:(0,d.C4)(["bi",n.getSortIcon])},null,2)],8,H)]),r[12]||(r[12]=(0,s.Lk)("div",{class:"col-author"},"作者",-1)),r[13]||(r[13]=(0,s.Lk)("div",{class:"col-publisher"},"出版商",-1)),r[14]||(r[14]=(0,s.Lk)("div",{class:"col-link"},"直达链接",-1)),r[15]||(r[15]=(0,s.Lk)("div",{class:"col-source"},"来源平台",-1))]),((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.sortedExampleBooks,(function(e){return(0,s.uX)(),(0,s.CE)("div",{class:"table-row",key:e.isbn},[(0,s.Lk)("div",Y,[(0,s.Lk)("div",ee,(0,d.v_)(e.title),1),(0,s.Lk)("div",re,[(0,s.Lk)("span",null,(0,d.v_)(e.year),1),(0,s.Lk)("span",null,"| "+(0,d.v_)(e.language),1),(0,s.Lk)("span",null,"| "+(0,d.v_)(e.filesize),1),(0,s.Lk)("span",null,"| "+(0,d.v_)(e.extension),1)])]),(0,s.Lk)("div",te,(0,d.v_)(e.author),1),(0,s.Lk)("div",ae,(0,d.v_)(e.publisher),1),r[16]||(r[16]=(0,s.Lk)("div",{class:"col-link"},[(0,s.Lk)("button",{class:"download-link",disabled:""},[(0,s.Lk)("i",{class:"fas fa-download"}),(0,s.eW)(" 示例 ")])],-1)),(0,s.Lk)("div",se,[(0,s.Lk)("span",oe,(0,d.v_)(e.source),1)])])})),128))])]))])}var le=t(5492);t(6910),t(8940);const ie={name:"SearchResults",props:{books:{type:Array,default:function(){return[]}},platforms:{type:Array,default:function(){return[{id:"zlibrary",name:"Z-Library",available:!0,total:0}]}},hasSearched:{type:Boolean,default:!1}},data:function(){return{sortOrder:"desc",debounceTimer:null,exampleBooks:[{title:"示例书籍 1",author:"作者名称",year:"2024",pages:"300",language:"简体中文",filesize:"10 MB",extension:"PDF",publisher:"示例出版社",source:"Z-Library",platform_id:"zlibrary"},{title:"示例书籍 2",author:"示例作者",year:"2023",pages:"250",language:"英文",filesize:"8 MB",extension:"EPUB",publisher:"Example Press",source:"Z-Library",platform_id:"zlibrary"}]}},computed:{getSortTitle:function(){switch(this.sortOrder){case"none":return"点击降序排列";case"desc":return"点击升序排列";case"asc":return"点击取消排序";default:return"默认排序标题"}},getSortIcon:function(){switch(this.sortOrder){case"none":return"bi-dash";case"desc":return"bi-sort-down";case"asc":return"bi-sort-up";default:return"bi-dash"}},sortedBooks:function(){return this.sortBooks(this.books)},sortedExampleBooks:function(){return this.sortBooks(this.exampleBooks)}},methods:{toggleSort:function(){switch(this.sortOrder){case"none":this.sortOrder="desc";break;case"desc":this.sortOrder="asc";break;case"asc":this.sortOrder="none";break;default:this.sortOrder="none"}this.persistSortOrder(this.sortOrder)},persistSortOrder:function(e){localStorage.setItem("bookSortOrder",e)},sortBooks:function(e){var r=this;return"none"===this.sortOrder?e:(0,le.A)(e).sort((function(e,t){var a=parseInt(e.year,10)||0,s=parseInt(t.year,10)||0;return a===s?e.title.localeCompare(t.title):"asc"===r.sortOrder?a-s:s-a}))}}},ce=(0,S.A)(ie,[["render",ne],["__scopeId","data-v-37bd61ad"]]),ue=ce,de={name:"App",components:{SearchBar:C,SearchResults:ue},data:function(){return{searchResults:[],platforms:[{id:"zlibrary",name:"Z-Library",available:!0,total:0}],hasSearched:!1}},methods:{handleSearch:function(e){var r=this;return(0,u.A)((0,i.A)().mark((function t(){var a,s;return(0,i.A)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,r.hasSearched=!0,r.searchResults=[],t.next=5,L.A.get("/api/zlibrary/s/".concat(encodeURIComponent(e)));case 5:a=t.sent,a.data&&(r.searchResults=a.data.books,a.data.platform_status&&(s=a.data.platform_status,r.platforms=[{id:s.id,name:s.name,available:s.available,total:s.total}])),t.next=14;break;case 9:t.prev=9,t.t0=t["catch"](0),console.error("Search failed:",t.t0),r.searchResults=[],r.platforms=r.platforms.map((function(e){return(0,c.A)((0,c.A)({},e),{},{available:!1,total:0})}));case 14:case"end":return t.stop()}}),t,null,[[0,9]])})))()}}},he=(0,S.A)(de,[["render",l]]),pe=he;var be=(0,a.Ef)(pe);be.mount("#app")}},r={};function t(a){var s=r[a];if(void 0!==s)return s.exports;var o=r[a]={exports:{}};return e[a].call(o.exports,o,o.exports,t),o.exports}t.m=e,(()=>{var e=[];t.O=(r,a,s,o)=>{if(!a){var n=1/0;for(u=0;u<e.length;u++){for(var[a,s,o]=e[u],l=!0,i=0;i<a.length;i++)(!1&o||n>=o)&&Object.keys(t.O).every((e=>t.O[e](a[i])))?a.splice(i--,1):(l=!1,o<n&&(n=o));if(l){e.splice(u--,1);var c=s();void 0!==c&&(r=c)}}return r}o=o||0;for(var u=e.length;u>0&&e[u-1][2]>o;u--)e[u]=e[u-1];e[u]=[a,s,o]}})(),(()=>{t.d=(e,r)=>{for(var a in r)t.o(r,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:r[a]})}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r)})(),(()=>{t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{var e={524:0};t.O.j=r=>0===e[r];var r=(r,a)=>{var s,o,[n,l,i]=a,c=0;if(n.some((r=>0!==e[r]))){for(s in l)t.o(l,s)&&(t.m[s]=l[s]);if(i)var u=i(t)}for(r&&r(a);c<n.length;c++)o=n[c],t.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return t.O(u)},a=self["webpackChunkebook_search"]=self["webpackChunkebook_search"]||[];a.forEach(r.bind(null,0)),a.push=r.bind(null,a.push.bind(a))})();var a=t.O(void 0,[504],(()=>t(7854)));a=t.O(a)})();
//# sourceMappingURL=app.d7c43398.js.map