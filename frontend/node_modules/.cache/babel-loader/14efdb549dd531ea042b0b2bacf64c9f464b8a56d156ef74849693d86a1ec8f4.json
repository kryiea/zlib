{"ast":null,"code":"import { createElementVNode as _createElementVNode, vModelText as _vModelText, withKeys as _withKeys, withDirectives as _withDirectives, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, normalizeClass as _normalizeClass, toDisplayString as _toDisplayString, createTextVNode as _createTextVNode } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"search-bar mb-4\"\n};\nvar _hoisted_2 = {\n  \"class\": \"card shadow-sm\"\n};\nvar _hoisted_3 = {\n  \"class\": \"card-body p-4\"\n};\nvar _hoisted_4 = {\n  \"class\": \"form-group\"\n};\nvar _hoisted_5 = {\n  \"class\": \"input-group search-input-group mb-3\"\n};\nvar _hoisted_6 = [\"disabled\"];\nvar _hoisted_7 = {\n  key: 0\n};\nvar _hoisted_8 = {\n  key: 1,\n  \"class\": \"spinner-border spinner-border-sm\",\n  role: \"status\",\n  \"aria-hidden\": \"true\"\n};\nvar _hoisted_9 = {\n  key: 0,\n  \"class\": \"alert alert-danger mt-2 search-error\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_createElementVNode(\"div\", _hoisted_3, [_cache[6] || (_cache[6] = _createElementVNode(\"div\", {\n    \"class\": \"search-header mb-4\"\n  }, [_createElementVNode(\"h3\", {\n    \"class\": \"search-title\"\n  }, \"📚 电子书搜索\"), _createElementVNode(\"p\", {\n    \"class\": \"search-subtitle\"\n  }, \"快速找到您需要的电子书资源\")], -1 /* HOISTED */)), _createElementVNode(\"div\", _hoisted_4, [_createElementVNode(\"div\", _hoisted_5, [_cache[3] || (_cache[3] = _createElementVNode(\"span\", {\n    \"class\": \"input-group-text search-icon\"\n  }, [_createElementVNode(\"i\", {\n    \"class\": \"bi bi-search\"\n  })], -1 /* HOISTED */)), _withDirectives(_createElementVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = function ($event) {\n      return $data.searchInput = $event;\n    }),\n    type: \"text\",\n    \"class\": \"form-control form-control-lg search-input\",\n    placeholder: \"输入书名、作者或ISBN码\",\n    onKeyup: _cache[1] || (_cache[1] = _withKeys(function () {\n      return $options.handleSearch && $options.handleSearch.apply($options, arguments);\n    }, [\"enter\"])),\n    autocomplete: \"off\"\n  }, null, 544 /* NEED_HYDRATION, NEED_PATCH */), [[_vModelText, $data.searchInput]]), _createElementVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = function () {\n      return $options.handleSearch && $options.handleSearch.apply($options, arguments);\n    }),\n    \"class\": _normalizeClass([\"btn btn-primary btn-lg search-button\", {\n      'btn-loading': $data.isSearching\n    }]),\n    disabled: !$options.isValidInput\n  }, [!$data.isSearching ? (_openBlock(), _createElementBlock(\"span\", _hoisted_7, \"搜索\")) : (_openBlock(), _createElementBlock(\"span\", _hoisted_8))], 10 /* CLASS, PROPS */, _hoisted_6)]), $data.error ? (_openBlock(), _createElementBlock(\"div\", _hoisted_9, [_cache[4] || (_cache[4] = _createElementVNode(\"i\", {\n    \"class\": \"bi bi-exclamation-triangle-fill me-2\"\n  }, null, -1 /* HOISTED */)), _createTextVNode(\" \" + _toDisplayString($data.error), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true), _cache[5] || (_cache[5] = _createElementVNode(\"div\", {\n    \"class\": \"search-tips\"\n  }, [_createElementVNode(\"i\", {\n    \"class\": \"bi bi-info-circle me-1\"\n  }), _createElementVNode(\"small\", {\n    \"class\": \"form-text\"\n  }, \"支持书名、作者或ISBN码（10位或13位数字）搜索\")], -1 /* HOISTED */))])])])]);\n}","map":{"version":3,"names":["key","role","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_cache","$event","$data","searchInput","type","placeholder","onKeyup","_withKeys","$options","handleSearch","apply","arguments","autocomplete","onClick","_normalizeClass","isSearching","disabled","isValidInput","_hoisted_7","_hoisted_8","_hoisted_6","error","_hoisted_9","_createTextVNode","_toDisplayString","_createCommentVNode"],"sources":["D:\\zlib\\frontend\\src\\components\\SearchBar.vue"],"sourcesContent":["<template>\r\n  <div class=\"search-bar mb-4\">\r\n    <div class=\"card shadow-sm\">\r\n      <div class=\"card-body p-4\">\r\n        <div class=\"search-header mb-4\">\r\n          <h3 class=\"search-title\">📚 电子书搜索</h3>\r\n          <p class=\"search-subtitle\">快速找到您需要的电子书资源</p>\r\n        </div>\r\n        <div class=\"form-group\">\r\n          <div class=\"input-group search-input-group mb-3\">\r\n            <span class=\"input-group-text search-icon\">\r\n              <i class=\"bi bi-search\"></i>\r\n            </span>\r\n            <input\r\n              v-model=\"searchInput\"\r\n              type=\"text\"\r\n              class=\"form-control form-control-lg search-input\"\r\n              placeholder=\"输入书名、作者或ISBN码\"\r\n              @keyup.enter=\"handleSearch\"\r\n              autocomplete=\"off\"\r\n            />\r\n            <button\r\n              @click=\"handleSearch\"\r\n              class=\"btn btn-primary btn-lg search-button\"\r\n              :disabled=\"!isValidInput\"\r\n              :class=\"{'btn-loading': isSearching}\"\r\n            >\r\n              <span v-if=\"!isSearching\">搜索</span>\r\n              <span v-else class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span>\r\n            </button>\r\n          </div>\r\n          <div v-if=\"error\" class=\"alert alert-danger mt-2 search-error\">\r\n            <i class=\"bi bi-exclamation-triangle-fill me-2\"></i>\r\n            {{ error }}\r\n          </div>\r\n          <div class=\"search-tips\">\r\n            <i class=\"bi bi-info-circle me-1\"></i>\r\n            <small class=\"form-text\">支持书名、作者或ISBN码（10位或13位数字）搜索</small>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport axios from 'axios';\r\nexport default {\r\n  name: 'SearchBar',\r\n  data() {\r\n    return {\r\n      searchInput: '',\r\n      error: '',\r\n      currentRequest: null,\r\n      debounceTimeout: null,\r\n      isSearching: false\r\n    };\r\n  },\r\n  computed: {\r\n    isValidInput() {\r\n      return this.searchInput.trim() && !this.error;\r\n    }\r\n  },\r\n  watch: {\r\n    searchInput(newValue) {\r\n      this.validateInput(newValue);\r\n    }\r\n  },\r\n  methods: {\r\n    validateInput(value) {\r\n      const trimmedValue = value.trim();\r\n      if (!trimmedValue) {\r\n        this.error = '';\r\n        return;\r\n      }\r\n\r\n      // ISBN validation\r\n      if (/^\\d+$/.test(trimmedValue)) {\r\n        if (trimmedValue.length !== 10 && trimmedValue.length !== 13) {\r\n          this.error = 'ISBN必须是10位或13位数字';\r\n          return;\r\n        }\r\n      }\r\n      this.error = '';\r\n    },\r\n    handleSearch() {\r\n      const initialInput = this.searchInput.trim();\r\n      if (!initialInput) {\r\n        this.error = '请输入搜索内容';\r\n        return;\r\n      }\r\n\r\n      // 清除之前的防抖定时器\r\n      if (this.debounceTimeout) {\r\n        clearTimeout(this.debounceTimeout);\r\n        console.log('已清除之前的防抖定时器');\r\n      }\r\n\r\n      // 如果存在进行中的请求，先取消\r\n      if (this.currentRequest) {\r\n        this.currentRequest.cancel('新的搜索请求');\r\n        console.log('已取消之前的搜索请求');\r\n        this.currentRequest = null;\r\n        this.isSearching = false;\r\n      }\r\n\r\n      // 确保每次搜索请求都能正确处理\r\n      if (this.isSearching) {\r\n        console.log('当前正在搜索，忽略新的搜索请求');\r\n        return;\r\n      }\r\n\r\n      // 设置新的防抖定时器\r\n      this.debounceTimeout = setTimeout(async () => {\r\n        try {\r\n          const currentInput = this.searchInput.trim();\r\n          if (!currentInput) return;\r\n\r\n          // 创建新的可取消请求\r\n          const cancelToken = axios.CancelToken.source();\r\n          this.currentRequest = cancelToken;\r\n          this.isSearching = true;\r\n          \r\n          this.$emit('search-start');\r\n          console.log('开始搜索:', currentInput);\r\n          \r\n          // 使用最新输入值发起请求\r\n          await this.$emit('search', currentInput, cancelToken.token);\r\n          \r\n          console.log('搜索成功:', currentInput);\r\n        } catch (error) {\r\n          // 统一处理取消请求的情况\r\n          if (axios.isCancel(error)) {\r\n            console.log('请求取消:', error.message);\r\n            return;\r\n          }\r\n          \r\n          console.error('搜索错误:', error);\r\n          let errorMessage = '搜索请求失败，请重试';\r\n          \r\n          if (error.response) {\r\n            errorMessage = error.response.data.message || '服务器返回错误';\r\n          } else if (error.request) {\r\n            errorMessage = '无法连接到服务器';\r\n          }\r\n          \r\n          // 显示错误但不清空输入\r\n          this.error = `搜索失败: ${errorMessage}`;\r\n          this.$emit('search-error', error);\r\n        } finally {\r\n          // 请求完成后清理\r\n          this.currentRequest = null;\r\n          this.isSearching = false;\r\n          this.$emit('search-end');\r\n          console.log('搜索结束');\r\n        }\r\n      }, 50); // 优化防抖时间\r\n    },\r\n    \r\n    beforeUnmount() {\r\n      // 组件卸载时清理\r\n      if (this.debounceTimeout) {\r\n        clearTimeout(this.debounceTimeout);\r\n      }\r\n      if (this.currentRequest) {\r\n        this.currentRequest.cancel('组件卸载');\r\n      }\r\n    },\r\n  }\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.search-bar {\r\n  max-width: 800px;\r\n  margin: 0 auto;\r\n}\r\n\r\n.card {\r\n  border: none;\r\n  background: #fff;\r\n  border-radius: 12px;\r\n  transition: all 0.3s ease;\r\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);\r\n}\r\n\r\n.card:hover {\r\n  transform: translateY(-3px);\r\n  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);\r\n}\r\n\r\n.search-header {\r\n  text-align: center;\r\n}\r\n\r\n.search-title {\r\n  font-weight: 700;\r\n  color: #4f46e5;\r\n  margin-bottom: 0.5rem;\r\n  font-size: 1.75rem;\r\n}\r\n\r\n.search-subtitle {\r\n  color: #6b7280;\r\n  font-size: 1rem;\r\n  margin-bottom: 0;\r\n}\r\n\r\n.search-input-group {\r\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\r\n  border-radius: 10px;\r\n  overflow: hidden;\r\n}\r\n\r\n.search-icon {\r\n  background-color: #fff;\r\n  border: none;\r\n  border-right: none;\r\n  color: #6b7280;\r\n  padding-left: 1.25rem;\r\n}\r\n\r\n.search-input {\r\n  border: none;\r\n  padding: 0.75rem 1rem;\r\n  font-size: 1rem;\r\n  border-left: none;\r\n  border-radius: 0;\r\n}\r\n\r\n.search-input:focus {\r\n  box-shadow: none;\r\n  border-color: transparent;\r\n}\r\n\r\n.search-button {\r\n  padding-left: 2rem;\r\n  padding-right: 2rem;\r\n  background: linear-gradient(135deg, #4f46e5, #3b82f6);\r\n  border: none;\r\n  font-weight: 600;\r\n  min-width: 100px;\r\n  transition: all 0.3s ease;\r\n}\r\n\r\n.search-button:hover:not(:disabled) {\r\n  background: linear-gradient(135deg, #4338ca, #2563eb);\r\n  transform: translateY(-1px);\r\n  box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);\r\n}\r\n\r\n.search-button:active:not(:disabled) {\r\n  transform: translateY(0);\r\n}\r\n\r\n.btn-loading {\r\n  opacity: 0.8;\r\n}\r\n\r\n.search-error {\r\n  border-radius: 8px;\r\n  font-size: 0.9rem;\r\n  display: flex;\r\n  align-items: center;\r\n}\r\n\r\n.search-tips {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-top: 0.75rem;\r\n  color: #6b7280;\r\n  padding: 0 0.5rem;\r\n}\r\n\r\n@media (max-width: 768px) {\r\n  .search-title {\r\n    font-size: 1.5rem;\r\n  }\r\n  \r\n  .search-subtitle {\r\n    font-size: 0.9rem;\r\n  }\r\n  \r\n  .search-button {\r\n    padding-left: 1.5rem;\r\n    padding-right: 1.5rem;\r\n  }\r\n}\r\n</style>"],"mappings":";;EACO,SAAM;AAAiB;;EACrB,SAAM;AAAgB;;EACpB,SAAM;AAAe;;EAKnB,SAAM;AAAY;;EAChB,SAAM;AAAqC;iBAT1D;;EAAAA,GAAA;AAAA;;EAAAA,GAAA;EA4B2B,SAAM,kCAAkC;EAACC,IAAI,EAAC,QAAQ;EAAC,aAAW,EAAC;;;EA5B9FD,GAAA;EA+B4B,SAAM;;;uBA9BhCE,mBAAA,CAyCM,OAzCNC,UAyCM,GAxCJC,mBAAA,CAuCM,OAvCNC,UAuCM,GAtCJD,mBAAA,CAqCM,OArCNE,UAqCM,G,0BApCJF,mBAAA,CAGM;IAHD,SAAM;EAAoB,IAC7BA,mBAAA,CAAsC;IAAlC,SAAM;EAAc,GAAC,UAAQ,GACjCA,mBAAA,CAA4C;IAAzC,SAAM;EAAiB,GAAC,eAAa,E,sBAE1CA,mBAAA,CA+BM,OA/BNG,UA+BM,GA9BJH,mBAAA,CAqBM,OArBNI,UAqBM,G,0BApBJJ,mBAAA,CAEO;IAFD,SAAM;EAA8B,IACxCA,mBAAA,CAA4B;IAAzB,SAAM;EAAc,G,sCAEzBA,mBAAA,CAOE;IApBd,uBAAAK,MAAA,QAAAA,MAAA,gBAAAC,MAAA;MAAA,OAcuBC,KAAA,CAAAC,WAAW,GAAAF,MAAA;IAAA;IACpBG,IAAI,EAAC,MAAM;IACX,SAAM,2CAA2C;IACjDC,WAAW,EAAC,eAAe;IAC1BC,OAAK,EAAAN,MAAA,QAAAA,MAAA,MAlBpBO,SAAA;MAAA,OAkB4BC,QAAA,CAAAC,YAAA,IAAAD,QAAA,CAAAC,YAAA,CAAAC,KAAA,CAAAF,QAAA,EAAAG,SAAA,CAAY;IAAA;IAC1BC,YAAY,EAAC;iEALJV,KAAA,CAAAC,WAAW,E,GAOtBR,mBAAA,CAQS;IAPNkB,OAAK,EAAAb,MAAA,QAAAA,MAAA;MAAA,OAAEQ,QAAA,CAAAC,YAAA,IAAAD,QAAA,CAAAC,YAAA,CAAAC,KAAA,CAAAF,QAAA,EAAAG,SAAA,CAAY;IAAA;IACpB,SAvBdG,eAAA,EAuBoB,sCAAsC;MAAA,eAEpBZ,KAAA,CAAAa;IAAW;IADlCC,QAAQ,GAAGR,QAAA,CAAAS;OAGCf,KAAA,CAAAa,WAAW,I,cAAxBtB,mBAAA,CAAmC,QA3BjDyB,UAAA,EA2BwC,IAAE,M,cAC5BzB,mBAAA,CAA8F,QAA9F0B,UAA8F,G,yBA5B5GC,UAAA,E,GA+BqBlB,KAAA,CAAAmB,KAAK,I,cAAhB5B,mBAAA,CAGM,OAHN6B,UAGM,G,0BAFJ3B,mBAAA,CAAoD;IAAjD,SAAM;EAAsC,6BAhC3D4B,gBAAA,CAgCgE,GACpD,GAAAC,gBAAA,CAAGtB,KAAA,CAAAmB,KAAK,iB,KAjCpBI,mBAAA,gB,0BAmCU9B,mBAAA,CAGM;IAHD,SAAM;EAAa,IACtBA,mBAAA,CAAsC;IAAnC,SAAM;EAAwB,IACjCA,mBAAA,CAA2D;IAApD,SAAM;EAAW,GAAC,4BAA0B,E","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}